\doxysection{Thread\+Pool.\+h}
\hypertarget{_thread_pool_8h_source}{}\label{_thread_pool_8h_source}\index{ingestion/gateway/include/telemetryhub/gateway/ThreadPool.h@{ingestion/gateway/include/telemetryhub/gateway/ThreadPool.h}}
\mbox{\hyperlink{_thread_pool_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00001}00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <condition\_variable>}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <future>}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <queue>}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00011}00011\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00013}00013\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetelemetryhub_1_1gateway}{telemetryhub::gateway}}\ \{}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00030}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool}{00030}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ab17f09c9cda16eb61c0d98c4b303c281}{ThreadPool}}\ \{}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00031}00031\ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00036}00036\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ab17f09c9cda16eb61c0d98c4b303c281}{ThreadPool}}(\textcolor{keywordtype}{size\_t}\ num\_threads\ =\ 0);}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00037}00037\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00041}00041\ \ \ \ \ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a1192f65426dcf4c8a392c123b0d0cb0e}{\string~ThreadPool}}();}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00043}00043\ \ \ \ \ \textcolor{comment}{//\ Non-\/copyable,\ non-\/movable}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00044}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a469feb6bd4488f8d311bf4202faffa20}{00044}}\ \ \ \ \ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a469feb6bd4488f8d311bf4202faffa20}{ThreadPool}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ab17f09c9cda16eb61c0d98c4b303c281}{ThreadPool}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00045}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aa3ef20ad6cbe28d7f1ee5786d27c71fa}{00045}}\ \ \ \ \ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ab17f09c9cda16eb61c0d98c4b303c281}{ThreadPool}}\&\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aa3ef20ad6cbe28d7f1ee5786d27c71fa}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ab17f09c9cda16eb61c0d98c4b303c281}{ThreadPool}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00046}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_af4662aa7ad3f5121d4de59f8bd438564}{00046}}\ \ \ \ \ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_af4662aa7ad3f5121d4de59f8bd438564}{ThreadPool}}(\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ab17f09c9cda16eb61c0d98c4b303c281}{ThreadPool}}\&\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00047}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a4f9e1393cd7d5b361d2f3211c3530617}{00047}}\ \ \ \ \ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ab17f09c9cda16eb61c0d98c4b303c281}{ThreadPool}}\&\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a4f9e1393cd7d5b361d2f3211c3530617}{operator=}}(\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ab17f09c9cda16eb61c0d98c4b303c281}{ThreadPool}}\&\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00048}00048\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00058}00058\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ F,\ \textcolor{keyword}{typename}...\ Args>}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00059}00059\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ac6b6f05ea985a0dd6d849f6778f07415}{submit}}(F\&\&\ func,\ Args\&\&...\ args)\ -\/>\ std::future<std::invoke\_result\_t<F,\ Args...>>;}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00064}\mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics}{00064}}\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics}{Metrics}}\ \{}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00065}\mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics_a2a4d45beefb695e9f41489e0d6ba52c2}{00065}}\ \ \ \ \ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics_a2a4d45beefb695e9f41489e0d6ba52c2}{jobs\_processed}}\{0\};\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00066}\mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics_a7100c7255663d3343bc8bfa16d9927ed}{00066}}\ \ \ \ \ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics_a7100c7255663d3343bc8bfa16d9927ed}{jobs\_queued}}\{0\};\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00067}\mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics_a3493fdc83e57ab6391289bed0def948d}{00067}}\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics_a3493fdc83e57ab6391289bed0def948d}{avg\_processing\_ms}}\{0.0\};\ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00068}\mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics_a1fa3907bce043fdeb01772c234ee3250}{00068}}\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structtelemetryhub_1_1gateway_1_1_thread_pool_1_1_metrics_a1fa3907bce043fdeb01772c234ee3250}{num\_threads}}\{0\};\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00069}00069\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00070}00070\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00071}00071\ \ \ \ \ Metrics\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_afa77bc66c4d7a2923d1f93ac082f02eb}{get\_metrics}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00076}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a1cdea5dcdec47fa2e7f130a2dd65d242}{00076}}\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a1cdea5dcdec47fa2e7f130a2dd65d242}{thread\_count}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a774f7016f656c10b3fa7625ad6ccc0f2}{workers\_}}.size();\ \}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00077}00077\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00078}00078\ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00079}00079\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ab91887708fab29ce92f07886629af8dd}{worker\_loop}}();}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00081}00081\ \ \ \ \ \textcolor{comment}{//\ Worker\ threads}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00082}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a774f7016f656c10b3fa7625ad6ccc0f2}{00082}}\ \ \ \ \ std::vector<std::thread>\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a774f7016f656c10b3fa7625ad6ccc0f2}{workers\_}};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00083}00083\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00084}00084\ \ \ \ \ \textcolor{comment}{//\ Job\ queue}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00085}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a51620a1723c61be8884fab267be1bf2c}{00085}}\ \ \ \ \ std::queue<std::function<void()>>\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a51620a1723c61be8884fab267be1bf2c}{jobs\_}};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00086}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aec93276b590de9e5c0aac5d36c7d0e89}{00086}}\ \ \ \ \ \textcolor{keyword}{mutable}\ std::mutex\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aec93276b590de9e5c0aac5d36c7d0e89}{queue\_mutex\_}};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00087}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a116cc9391d975f07c2fb93c9ac38de62}{00087}}\ \ \ \ \ std::condition\_variable\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a116cc9391d975f07c2fb93c9ac38de62}{cv\_}};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00088}00088\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00089}00089\ \ \ \ \ \textcolor{comment}{//\ Shutdown\ flag}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00090}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aacd9749cb3bc846e01a526a8efdfc95a}{00090}}\ \ \ \ \ std::atomic<bool>\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aacd9749cb3bc846e01a526a8efdfc95a}{stop\_}}\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00091}00091\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00092}00092\ \ \ \ \ \textcolor{comment}{//\ Metrics}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00093}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a03d92f8cfa9c606190f5e4541194724c}{00093}}\ \ \ \ \ std::atomic<uint64\_t>\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a03d92f8cfa9c606190f5e4541194724c}{jobs\_processed\_}}\{0\};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00094}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aaa5d9df837e78cd53e1ec479b35a04b7}{00094}}\ \ \ \ \ std::atomic<uint64\_t>\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aaa5d9df837e78cd53e1ec479b35a04b7}{total\_processing\_time\_us\_}}\{0\};\ \ \textcolor{comment}{//\ microseconds}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00095}00095\ \};}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00097}00097\ \textcolor{comment}{//\ Template\ implementation\ must\ be\ in\ header}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00098}00098\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ F,\ \textcolor{keyword}{typename}...\ Args>}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00099}\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ac6b6f05ea985a0dd6d849f6778f07415}{00099}}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_ac6b6f05ea985a0dd6d849f6778f07415}{ThreadPool::submit}}(F\&\&\ func,\ Args\&\&...\ args)\ -\/>\ std::future<std::invoke\_result\_t<F,\ Args...>>}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00100}00100\ \{}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00101}00101\ \ \ \ \ \textcolor{keyword}{using\ }return\_type\ =\ std::invoke\_result\_t<F,\ Args...>;}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00102}00102\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00103}00103\ \ \ \ \ \textcolor{comment}{//\ Wrap\ in\ packaged\_task\ to\ get\ future}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00104}00104\ \ \ \ \ \textcolor{keyword}{auto}\ task\ =\ std::make\_shared<std::packaged\_task<return\_type()>>(}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00105}00105\ \ \ \ \ \ \ \ \ std::bind(std::forward<F>(func),\ std::forward<Args>(args)...)}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00106}00106\ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00107}00107\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00108}00108\ \ \ \ \ std::future<return\_type>\ result\ =\ task-\/>get\_future();}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00109}00109\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00110}00110\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00111}00111\ \ \ \ \ \ \ \ \ std::lock\_guard\ lock(\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aec93276b590de9e5c0aac5d36c7d0e89}{queue\_mutex\_}});}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00112}00112\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00113}00113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_aacd9749cb3bc846e01a526a8efdfc95a}{stop\_}})\ \{}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}ThreadPool\ is\ stopped,\ cannot\ submit\ new\ jobs"{}});}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00115}00115\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00116}00116\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00117}00117\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a51620a1723c61be8884fab267be1bf2c}{jobs\_}}.emplace([task]()\ \{\ (*task)();\ \});}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00118}00118\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00119}00119\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00120}00120\ \ \ \ \ \mbox{\hyperlink{classtelemetryhub_1_1gateway_1_1_thread_pool_a116cc9391d975f07c2fb93c9ac38de62}{cv\_}}.notify\_one();}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00121}00121\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00122}00122\ \}}
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{_thread_pool_8h_source_l00124}00124\ \}\ \textcolor{comment}{//\ namespace\ telemetryhub::gateway}}

\end{DoxyCode}
